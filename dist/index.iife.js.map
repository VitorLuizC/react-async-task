{"version":3,"file":"index.iife.js","sources":["../src/useAsyncTaskLazy/isAbortError.ts","../src/store/ActionType.ts","../src/store/reducer.ts","../src/store/getInitialState.ts","../src/useAbortController/getAbortController.ts","../src/useMounted/useMounted.ts","../src/useAbortController/useAbortController.ts","../src/useAsyncTaskReducer/useAsyncTaskReducer.ts","../src/useAsyncTaskLazy/useAsyncTaskLazy.ts","../src/useAsyncTask/useAsyncTask.ts"],"sourcesContent":["import type AbortError from './AbortError';\n\nfunction isAbortError(error: unknown): error is AbortError {\n  // The environment doesn't support 'DOMException'.\n  if (typeof DOMException === 'undefined') return false;\n\n  if (error instanceof DOMException) {\n    return error.name === 'AbortError';\n  }\n\n  return false;\n}\n\nexport default isAbortError;\n","enum ActionType {\n  FAILED = 'FAILED',\n  STARTED = 'STARTED',\n  FINISHED = 'FINISHED',\n  SUCCEEDED = 'SUCCEEDED',\n}\n\nexport default ActionType;\n","import ActionType from './ActionType';\nimport type State from './State';\nimport type Action from './Action';\n\nfunction reducer<T>(state: State<T>, action: Action<T>): State<T> {\n  switch (action.type) {\n    case ActionType.STARTED:\n      return {\n        ...state,\n        pendingTasks: state.pendingTasks + 1,\n      };\n    case ActionType.FINISHED:\n      return {\n        ...state,\n        pendingTasks: state.pendingTasks - 1,\n      };\n    case ActionType.FAILED:\n      return {\n        ...state,\n        error: action.error,\n        result: null,\n      };\n    case ActionType.SUCCEEDED:\n      return {\n        ...state,\n        error: null,\n        result: action.result,\n      };\n    default:\n      throw new Error('Invalid action type.');\n  }\n}\n\nexport default reducer;\n","import type State from './State';\n\n/** Get the initial state for the store. */\nfunction getInitialState<T>(): State<T> {\n  return {\n    error: null,\n    result: null,\n    pendingTasks: 0,\n  };\n}\n\nexport default getInitialState;\n","/**\n * Get a new `AbortController` instance if the environment supports it.\n * Otherwise, it returns `null`.\n */\nfunction getAbortController(): AbortController | null {\n  if (typeof AbortController === 'undefined') {\n    return null;\n  }\n\n  return new AbortController();\n}\n\nexport default getAbortController;\n","import { useCallback, useLayoutEffect, useRef } from 'react';\n\n/** React.js hook that provides a function to check if component is mounted. */\nfunction useMounted(): () => boolean {\n  const mountedRef = useRef(true);\n\n  useLayoutEffect(\n    () => () => {\n      mountedRef.current = false;\n    },\n    [],\n  );\n\n  return useCallback(() => mountedRef.current, []);\n}\n\nexport default useMounted;\n","import { useCallback, useLayoutEffect, useState } from 'react';\nimport getAbortController from './getAbortController';\nimport useMounted from '../useMounted';\n\nexport type UseAbortControllerResult = {\n  abort: () => void;\n  signal: AbortSignal | null;\n};\n\n/**\n * React.js hook that provides the `AbortController` signal object and the\n * abort function.\n */\nfunction useAbortController(): UseAbortControllerResult {\n  const mounted = useMounted();\n\n  const [controller, setController] = useState(getAbortController);\n\n  useLayoutEffect(() => () => controller?.abort(), [controller]);\n\n  const abort = useCallback(() => {\n    if (!mounted()) return;\n\n    setController(getAbortController);\n  }, [mounted]);\n\n  return {\n    abort,\n    signal: controller?.signal ?? null,\n  };\n}\n\nexport default useAbortController;\n","import { useCallback, useMemo, useReducer } from 'react';\nimport { Action, getInitialState, reducer, State } from '../store';\nimport useMounted from '../useMounted';\n\nexport type AsyncTaskReducer<Result> = readonly [\n  state: State<Result>,\n  dispatch: (action: Action<Result>) => void,\n];\n\nfunction useAsyncTaskReducer<Result>(): AsyncTaskReducer<Result> {\n  const mounted = useMounted();\n\n  const [state, dispatch] = useReducer(\n    // Prettier doesn't yet support instantiation expressions.\n    // eslint-disable-next-line prettier/prettier\n    reducer<Result>,\n    useMemo(getInitialState<Result>, []),\n  );\n\n  const dispatchOnlyIfMounted = useCallback((action: Action<Result>) => {\n    if (mounted()) {\n      dispatch(action);\n    }\n  }, []);\n\n  return [state, dispatchOnlyIfMounted];\n}\n\nexport default useAsyncTaskReducer;\n","import { useCallback } from 'react';\nimport isAbortError from './isAbortError';\nimport { ActionType } from '../store';\nimport useAbortController from '../useAbortController';\nimport useAsyncTaskReducer from '../useAsyncTaskReducer';\nimport type AsyncTask from '../AsyncTask';\n\nexport type AsyncTaskLazyResult<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n  executeAsyncTask: (task: AsyncTask<Result>) => Promise<void>;\n}>;\n\nfunction useAsyncTaskLazy<Result>(): AsyncTaskLazyResult<Result> {\n  const { signal } = useAbortController();\n\n  const [state, dispatch] = useAsyncTaskReducer<Result>();\n\n  const executeAsyncTask = useCallback(async (task: AsyncTask<Result>) => {\n    dispatch({ type: ActionType.STARTED });\n\n    try {\n      dispatch({\n        type: ActionType.SUCCEEDED,\n        result: await task({\n          signal: signal ?? undefined,\n        }),\n      });\n    } catch (error) {\n      if (isAbortError(error)) {\n        return;\n      }\n\n      dispatch({ type: ActionType.FAILED, error: error as Error });\n    } finally {\n      dispatch({ type: ActionType.FINISHED });\n    }\n  }, []);\n\n  return {\n    error: state.error,\n    result: state.result,\n    pending: state.pendingTasks > 0,\n    executeAsyncTask,\n  };\n}\n\nexport default useAsyncTaskLazy;\n","import { useLayoutEffect, useRef } from 'react';\nimport useLazyAsyncTask from '../useAsyncTaskLazy';\nimport type AsyncTask from '../AsyncTask';\n\nexport type AsyncTaskResult<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n}>;\n\nfunction useAsyncTask<Result>(\n  task: AsyncTask<Result>,\n): AsyncTaskResult<Result> {\n  const firstRenderRef = useRef(true);\n\n  const { error, result, pending, executeAsyncTask } =\n    useLazyAsyncTask<Result>();\n\n  useLayoutEffect(() => {\n    firstRenderRef.current = false;\n    executeAsyncTask(task);\n  }, [task, executeAsyncTask]);\n\n  return {\n    error,\n    result,\n    pending: firstRenderRef.current || pending,\n  };\n}\n\nexport default useAsyncTask;\n"],"names":["ActionType","useRef","useLayoutEffect","useCallback","useState","useReducer","useMemo","useLazyAsyncTask"],"mappings":"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"}