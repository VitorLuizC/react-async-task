{"version":3,"file":"index.iife.js","sources":["../src/hooks/isAbortError.ts","../src/store/ActionType.ts","../src/store/reducer.ts","../src/store/getInitialState.ts","../src/hooks/getAbortController.ts","../src/hooks/useMounted.ts","../src/hooks/useAbortController.ts","../src/hooks/useImperativeAsyncTask.ts","../src/hooks/useLazyAsyncTask.ts","../src/hooks/useImmediateAsyncTask.ts"],"sourcesContent":["import type AbortError from './AbortError';\n\nfunction isAbortError(error: unknown): error is AbortError {\n  // The environment doesn't support 'DOMException'.\n  if (typeof DOMException === 'undefined') return false;\n\n  if (error instanceof DOMException) {\n    return error.name === 'AbortError';\n  }\n\n  return false;\n}\n\nexport default isAbortError;\n","enum ActionType {\n  FAILED = 'FAILED',\n  STARTED = 'STARTED',\n  FINISHED = 'FINISHED',\n  SUCCEEDED = 'SUCCEEDED',\n}\n\nexport default ActionType;\n","import ActionType from './ActionType';\nimport type { Reducer } from './types';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst reducer: Reducer<any> = (state, action) => {\n  switch (action.type) {\n    case ActionType.STARTED:\n      return {\n        ...state,\n        pendingTasks: state.pendingTasks + 1,\n      };\n    case ActionType.FINISHED:\n      return {\n        ...state,\n        pendingTasks: state.pendingTasks - 1,\n      };\n    case ActionType.FAILED:\n      return {\n        ...state,\n        error: action.error,\n        result: null,\n      };\n    case ActionType.SUCCEEDED:\n      return {\n        ...state,\n        error: null,\n        result: action.result,\n      };\n    default:\n      throw new Error(\"An invalid action was dispatched to 'useTaskReducer'.\");\n  }\n};\n\nexport default reducer;\n","import type { State } from './types';\n\n/** Get the initial state for the store. */\nfunction getInitialState<Result>(): State<Result> {\n  return {\n    error: null,\n    result: null,\n    pendingTasks: 0,\n  };\n}\n\nexport default getInitialState;\n","/**\n * Get a new `AbortController` instance if the environment supports it.\n * Otherwise, it returns `null`.\n */\nfunction getAbortController(): AbortController | null {\n  if (typeof AbortController === 'undefined') {\n    return null;\n  }\n\n  return new AbortController();\n}\n\nexport default getAbortController;\n","import { useCallback, useLayoutEffect, useRef } from 'react';\n\nexport type UseMountedResult = () => boolean;\n\n/** React.js hook that provides a function to check if component is mounted. */\nfunction useMounted(): UseMountedResult {\n  const mountedRef = useRef(true);\n\n  useLayoutEffect(\n    () => () => {\n      mountedRef.current = false;\n    },\n    [],\n  );\n\n  return useCallback(() => mountedRef.current, []);\n}\n\nexport default useMounted;\n","import { useCallback, useLayoutEffect, useState } from 'react';\nimport getAbortController from './getAbortController';\nimport useMounted from './useMounted';\n\nexport type UseAbortControllerResult = {\n  abort: () => void;\n  signal: AbortSignal | null;\n};\n\n/**\n * React.js hook that provides the `AbortController` signal object and the\n * abort function.\n */\nfunction useAbortController(): UseAbortControllerResult {\n  const mounted = useMounted();\n  const [controller, setController] = useState(getAbortController);\n\n  useLayoutEffect(() => () => controller?.abort(), [controller]);\n\n  const abort = useCallback(() => {\n    if (!mounted()) return;\n\n    setController(getAbortController);\n  }, [mounted]);\n\n  return {\n    abort,\n    signal: controller?.signal ?? null,\n  };\n}\n\nexport default useAbortController;\n","import { useCallback, useMemo, useReducer } from 'react';\nimport type AsyncTask from './AsyncTask';\nimport isAbortError from './isAbortError';\nimport { ActionType, getInitialState, reducer, Reducer, State } from '../store';\nimport useAbortController from './useAbortController';\n\nexport type ImperativeAsyncTask<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n  executeTask: (task: AsyncTask<Result>) => Promise<void>;\n}>;\n\nfunction useImperativeAsyncTask<Result>(): ImperativeAsyncTask<Result> {\n  const { signal } = useAbortController();\n\n  const initialState = useMemo<State<Result>>(getInitialState, []);\n\n  const [state, dispatch] = useReducer<Reducer<Result>>(reducer, initialState);\n\n  const executeTask = useCallback(async (task: AsyncTask<Result>) => {\n    dispatch({ type: ActionType.STARTED });\n\n    try {\n      dispatch({\n        type: ActionType.SUCCEEDED,\n        result: await task({\n          signal: signal ?? undefined,\n        }),\n      });\n    } catch (error) {\n      if (isAbortError(error)) {\n        return;\n      }\n\n      dispatch({ type: ActionType.FAILED, error: error as Error });\n    } finally {\n      dispatch({ type: ActionType.FINISHED });\n    }\n  }, []);\n\n  const { error, result, pendingTasks } = state;\n\n  return {\n    error,\n    result,\n    pending: pendingTasks > 0,\n    executeTask,\n  };\n}\n\nexport default useImperativeAsyncTask;\n","import { useCallback } from 'react';\nimport type AsyncTask from './AsyncTask';\nimport useImperativeAsyncTask from './useImperativeAsyncTask';\n\nexport type LazyAsyncTask<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n  executeTask: () => Promise<void>;\n}>;\n\nfunction useLazyAsyncTask<Result>(\n  task: AsyncTask<Result>,\n): LazyAsyncTask<Result> {\n  const { executeTask, ...state } = useImperativeAsyncTask<Result>();\n\n  return {\n    ...state,\n    executeTask: useCallback(() => executeTask(task), [task]),\n  };\n}\n\nexport default useLazyAsyncTask;\n","import { useLayoutEffect, useRef } from 'react';\nimport type AsyncTask from './AsyncTask';\nimport useLazyAsyncTask from './useLazyAsyncTask';\n\nexport type ImmediateAsyncTask<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n  executeTask: () => Promise<void>;\n}>;\n\nfunction useImmediateAsyncTask<Result>(\n  task: AsyncTask<Result>,\n): ImmediateAsyncTask<Result> {\n  const firstRenderRef = useRef(true);\n\n  const { error, result, pending, executeTask } = useLazyAsyncTask(task);\n\n  useLayoutEffect(() => {\n    executeTask();\n\n    return () => {\n      firstRenderRef.current = false;\n    };\n  }, [executeTask]);\n\n  return {\n    error,\n    result,\n    pending: firstRenderRef.current || pending,\n    executeTask,\n  };\n}\n\nexport default useImmediateAsyncTask;\n"],"names":["ActionType","useRef","useLayoutEffect","useCallback","useState","useMemo","useReducer"],"mappings":"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"}