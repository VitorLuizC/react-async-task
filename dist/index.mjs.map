{"version":3,"file":"index.mjs","sources":["../src/hooks/isAbortError.ts","../src/store/ActionType.ts","../src/store/reducer.ts","../src/store/getInitialState.ts","../src/hooks/getAbortController.ts","../src/hooks/useMounted.ts","../src/hooks/useAbortController.ts","../src/hooks/useImperativeAsyncTask.ts","../src/hooks/useLazyAsyncTask.ts","../src/hooks/useImmediateAsyncTask.ts"],"sourcesContent":["import type AbortError from './AbortError';\n\nfunction isAbortError(error: unknown): error is AbortError {\n  // The environment doesn't support 'DOMException'.\n  if (typeof DOMException === 'undefined') return false;\n\n  if (error instanceof DOMException) {\n    return error.name === 'AbortError';\n  }\n\n  return false;\n}\n\nexport default isAbortError;\n","enum ActionType {\n  FAILED = 'FAILED',\n  STARTED = 'STARTED',\n  FINISHED = 'FINISHED',\n  SUCCEEDED = 'SUCCEEDED',\n}\n\nexport default ActionType;\n","import ActionType from './ActionType';\nimport type { Reducer } from './types';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst reducer: Reducer<any> = (state, action) => {\n  switch (action.type) {\n    case ActionType.STARTED:\n      return {\n        ...state,\n        pendingTasks: state.pendingTasks + 1,\n      };\n    case ActionType.FINISHED:\n      return {\n        ...state,\n        pendingTasks: state.pendingTasks - 1,\n      };\n    case ActionType.FAILED:\n      return {\n        ...state,\n        error: action.error,\n        result: null,\n      };\n    case ActionType.SUCCEEDED:\n      return {\n        ...state,\n        error: null,\n        result: action.result,\n      };\n    default:\n      throw new Error(\"An invalid action was dispatched to 'useTaskReducer'.\");\n  }\n};\n\nexport default reducer;\n","import type { State } from './types';\n\n/** Get the initial state for the store. */\nfunction getInitialState<Result>(): State<Result> {\n  return {\n    error: null,\n    result: null,\n    pendingTasks: 0,\n  };\n}\n\nexport default getInitialState;\n","/**\n * Get a new `AbortController` instance if the environment supports it.\n * Otherwise, it returns `null`.\n */\nfunction getAbortController(): AbortController | null {\n  if (typeof AbortController === 'undefined') {\n    return null;\n  }\n\n  return new AbortController();\n}\n\nexport default getAbortController;\n","import { useCallback, useLayoutEffect, useRef } from 'react';\n\nexport type UseMountedResult = () => boolean;\n\n/** React.js hook that provides a function to check if component is mounted. */\nfunction useMounted(): UseMountedResult {\n  const mountedRef = useRef(true);\n\n  useLayoutEffect(\n    () => () => {\n      mountedRef.current = false;\n    },\n    [],\n  );\n\n  return useCallback(() => mountedRef.current, []);\n}\n\nexport default useMounted;\n","import { useCallback, useLayoutEffect, useState } from 'react';\nimport getAbortController from './getAbortController';\nimport useMounted from './useMounted';\n\nexport type UseAbortControllerResult = {\n  abort: () => void;\n  signal: AbortSignal | null;\n};\n\n/**\n * React.js hook that provides the `AbortController` signal object and the\n * abort function.\n */\nfunction useAbortController(): UseAbortControllerResult {\n  const mounted = useMounted();\n  const [controller, setController] = useState(getAbortController);\n\n  useLayoutEffect(() => () => controller?.abort(), [controller]);\n\n  const abort = useCallback(() => {\n    if (!mounted()) return;\n\n    setController(getAbortController);\n  }, [mounted]);\n\n  return {\n    abort,\n    signal: controller?.signal ?? null,\n  };\n}\n\nexport default useAbortController;\n","import { useCallback, useMemo, useReducer } from 'react';\nimport type AsyncTask from './AsyncTask';\nimport isAbortError from './isAbortError';\nimport { ActionType, getInitialState, reducer, Reducer, State } from '../store';\nimport useAbortController from './useAbortController';\n\nexport type ImperativeAsyncTask<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n  executeTask: (task: AsyncTask<Result>) => Promise<void>;\n}>;\n\nfunction useImperativeAsyncTask<Result>(): ImperativeAsyncTask<Result> {\n  const { signal } = useAbortController();\n\n  const initialState = useMemo<State<Result>>(getInitialState, []);\n\n  const [state, dispatch] = useReducer<Reducer<Result>>(reducer, initialState);\n\n  const executeTask = useCallback(async (task: AsyncTask<Result>) => {\n    dispatch({ type: ActionType.STARTED });\n\n    try {\n      dispatch({\n        type: ActionType.SUCCEEDED,\n        result: await task({\n          signal: signal ?? undefined,\n        }),\n      });\n    } catch (error) {\n      if (isAbortError(error)) {\n        return;\n      }\n\n      dispatch({ type: ActionType.FAILED, error: error as Error });\n    } finally {\n      dispatch({ type: ActionType.FINISHED });\n    }\n  }, []);\n\n  const { error, result, pendingTasks } = state;\n\n  return {\n    error,\n    result,\n    pending: pendingTasks > 0,\n    executeTask,\n  };\n}\n\nexport default useImperativeAsyncTask;\n","import { useCallback } from 'react';\nimport type AsyncTask from './AsyncTask';\nimport useImperativeAsyncTask from './useImperativeAsyncTask';\n\nexport type LazyAsyncTask<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n  executeTask: () => Promise<void>;\n}>;\n\nfunction useLazyAsyncTask<Result>(\n  task: AsyncTask<Result>,\n): LazyAsyncTask<Result> {\n  const { executeTask, ...state } = useImperativeAsyncTask<Result>();\n\n  return {\n    ...state,\n    executeTask: useCallback(() => executeTask(task), [task]),\n  };\n}\n\nexport default useLazyAsyncTask;\n","import { useLayoutEffect, useRef } from 'react';\nimport type AsyncTask from './AsyncTask';\nimport useLazyAsyncTask from './useLazyAsyncTask';\n\nexport type ImmediateAsyncTask<Result> = Readonly<{\n  error: Error | null;\n  result: Result | null;\n  pending: boolean;\n  executeTask: () => Promise<void>;\n}>;\n\nfunction useImmediateAsyncTask<Result>(\n  task: AsyncTask<Result>,\n): ImmediateAsyncTask<Result> {\n  const firstRenderRef = useRef(true);\n\n  const { error, result, pending, executeTask } = useLazyAsyncTask(task);\n\n  useLayoutEffect(() => {\n    executeTask();\n\n    return () => {\n      firstRenderRef.current = false;\n    };\n  }, [executeTask]);\n\n  return {\n    error,\n    result,\n    pending: firstRenderRef.current || pending,\n    executeTask,\n  };\n}\n\nexport default useImmediateAsyncTask;\n"],"names":["ActionType"],"mappings":"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"}